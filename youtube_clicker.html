<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Clicker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style>
    :root {
      --main-red: #ff0000;
      --main-dark: #232323;
      --main-light: #fff;
      --accent: #9146ff;
      --button-size: 160px;
      --menu-bg: #181818f2;
    }
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI',sans-serif;
      background: var(--main-dark);
      color: var(--main-light);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .main-btn {
      background: none;
      border: none;
      outline: none;
      margin: 32px 0 16px 0;
      cursor: pointer;
      width: var(--button-size);
      height: var(--button-size);
      border-radius: 999px;
      box-shadow: 0 4px 24px #000a;
      transition: transform .09s;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .main-btn:active { transform: scale(0.97);}
    .main-btn img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #fff;
    }
    .yt-logo {
      width: 90%;
      height: 90%;
      display: block;
      margin: auto;
    }
    .menu {
      background: var(--menu-bg);
      border-radius: 16px;
      padding: 24px 20px;
      margin: 14px 0;
      min-width: 280px;
      max-width: 98vw;
      box-shadow: 0 2px 16px #222b;
    }
    .menu h2 { margin-top: 0; }
    .profile-pic {
      border-radius: 50%;
      border: 3px solid var(--main-red);
      width: 70px;
      height: 70px;
      object-fit: cover;
      background: #fff;
      margin: 0 auto 14px auto;
      display: block;
    }
    .menu-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px 0 0 0;
    }
    .menu-btn {
      background: #333;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1em;
      margin: 2px 0;
      transition: background .15s;
    }
    .menu-btn.active, .menu-btn:active {
      background: var(--main-red);
      color: #fff;
    }
    .shop-list, .video-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .shop-item, .video-item {
      background: #292929;
      margin: 7px 0;
      padding: 12px 8px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1em;
    }
    .shop-item button, .video-item button {
      margin-left: 8px;
      background: var(--main-red);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 6px 13px;
      cursor: pointer;
      font-size: 1em;
      transition: background .15s;
    }
    .shop-item button:active { background: #c00;}
    .input-block {
      margin: 10px 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }
    .input-block input[type="text"] {
      border-radius: 8px;
      border: 1px solid #444;
      padding: 7px 12px;
      font-size: 1em;
      background: #222;
      color: #fff;
      outline: none;
      width: 220px;
    }
    .input-block input[type="file"] {
      color: #fff;
      background: #232323;
    }
    .hidden { display: none !important;}
    .stats-row {
      display: flex;
      gap: 18px;
      justify-content: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .stat {
      background: #292929;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 1.1em;
      min-width: 80px;
      text-align: center;
    }
    .boosted { color: #ffec00; font-weight: bold;}
    .play-btn-badge {
      display: inline-block;
      background: #fff;
      color: var(--main-red);
      font-weight: bold;
      border-radius: 10px;
      padding: 2px 12px;
      margin-left: 7px;
      font-size: 1em;
    }
    .code-box {
      background: #232323;
      color: #fff;
      border-radius: 8px;
      padding: 7px 13px;
      font-family: monospace;
      font-size: 1.1em;
      letter-spacing: 1.4px;
      margin: 8px 0 10px 0;
      user-select: all;
      display: inline-block;
    }
    @media (max-width: 600px) {
      .menu { min-width: unset; padding: 14px 2vw;}
      .main-btn { --button-size: 110px;}
      .profile-pic { width: 50px; height: 50px;}
      .stat { font-size: 1em;}
      .menu-btn { font-size: .97em;}
    }
  </style>
</head>
<body>
  <div id="game"></div>
  <input id="profilePicInput" type="file" accept="image/*" style="display:none" />
  <input id="profilePicInputTwitch" type="file" accept="image/*" style="display:none" />

<script>
/** --- Game Constants and State --- **/
const BOOST_PLAY_BUTTONS = [
  {subs: 100000, label: "Silber", color:"#c0c0c0"},
  {subs: 1000000, label: "Gold", color:"#ffd700"},
  {subs: 10000000, label: "Diamant", color:"#00bfff"},
  {subs: 100000000, label: "Rubin", color:"#e0115f"}
];

const CLIPS_PER_VIDEO = 10;
const CUT_TIME_BASE = 10; // seconds
const CUT_TIME_PER_CLIP = 1.5; // sec extra per clip
const CUTTER_SPEED_FACTOR = 0.87; // lower = faster
const CLICKER_BASE = 1;
const STREAMCLICKS_BASE = 1;
const STREAM_UNLOCK_SUBS = 10000;

const UPGRADE_BASE_PRICES = {
  cutter: 100,
  clicker: 50,
  manager: 5000,
  streamer: 2000
};
const UPGRADE_EXP = 1.47;

const MANAGER_SPEED_BOOST = 0.05; // 5% speed per upgrade

const DEFAULT_PROFILE_PIC = "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Youtube%28amin%29.png/600px-Youtube%28amin%29.png";
const DEFAULT_TWITCH_PIC = "https://static-cdn.jtvnw.net/jtv_user_pictures/twitch-profile_image.png";

/** --- Util --- **/
function getRandomCode(len = 10) {
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let s = "";
  for (let i=0; i<len; ++i) s += chars[Math.floor(Math.random()*chars.length)];
  return s;
}
function formatNumber(n) {
  if (n < 1000) return n.toString();
  if (n < 1e6) return (n/1e3).toFixed(1).replace(/\.0$/, '')+"k";
  if (n < 1e9) return (n/1e6).toFixed(1).replace(/\.0$/, '')+"M";
  return (n/1e9).toFixed(1).replace(/\.0$/, '')+"B";
}
function saveState() {
  localStorage.setItem("ytclicker_save", JSON.stringify(state));
}
function loadState() {
  try {
    const s = localStorage.getItem("ytclicker_save");
    if (!s) return false;
    let data = JSON.parse(s);
    Object.assign(state, data);
    // Rehydrate possible missing fields (for updates)
    for (const k in defaultState) if (!(k in state)) state[k] = defaultState[k];
    return true;
  } catch { return false; }
}
function importState(code) {
  try {
    const key = "ytclicker_acc_"+code.toUpperCase();
    const data = localStorage.getItem(key);
    if (!data) return false;
    Object.assign(state, JSON.parse(data));
    saveState();
    return true;
  } catch { return false; }
}
function exportState() {
  if (!state.profileCode) state.profileCode = getRandomCode(10);
  localStorage.setItem("ytclicker_acc_"+state.profileCode, JSON.stringify(state));
}
function clone(obj) { return JSON.parse(JSON.stringify(obj)); }

/** --- Game State --- **/
const defaultState = {
  ytName: "",
  ytPic: DEFAULT_PROFILE_PIC,
  twName: "",
  twPic: DEFAULT_TWITCH_PIC,
  profileCode: "",
  subs: 0,
  clips: 0,
  videos: [],
  abosLost: 0,
  upgrades: {
    cutter: 0,
    clicker: 0,
    manager: 0,
    streamer: 0
  },
  shopPrices: clone(UPGRADE_BASE_PRICES),
  shopExp: UPGRADE_EXP,
  auto: {
    cutter: 0,   // cutting in progress, >0 = seconds left
    clicker: 0,  // time to next click
    streamer: 0  // time to next stream click
  },
  twitchUnlocked: false,
  playButtons: [],
  boosts: 1,
  twClicks: 0,
  menu: "main",
  twSubs: 0
};
let state = clone(defaultState);
loadState();

/** --- Main Render --- **/
const gameDiv = document.getElementById("game");
function render() {
  gameDiv.innerHTML = "";
  renderMenu();
}
function renderMenu() {
  // Top menu bar
  const menuBar = document.createElement("div");
  menuBar.className = "menu-buttons";
  const menus = [
    {id:"main", label:"YouTube"},
    {id:"cut", label:"Cutten"},
    {id:"shop", label:"Shop"},
    {id:"profile", label:"Profil"}
  ];
  if (state.twitchUnlocked) menus.splice(1,0,{id:"twitch", label:"Twitch"});
  menus.forEach(menu => {
    const btn = document.createElement("button");
    btn.textContent = menu.label;
    btn.className = "menu-btn" + (state.menu===menu.id ? " active":"");
    btn.onclick = () => { state.menu = menu.id; render(); };
    menuBar.appendChild(btn);
  });
  gameDiv.appendChild(menuBar);

  // Menu contents
  if (state.menu==="main") renderMainMenu();
  if (state.menu==="cut") renderCutMenu();
  if (state.menu==="shop") renderShopMenu();
  if (state.menu==="profile") renderProfileMenu();
  if (state.menu==="twitch") renderTwitchMenu();
}
function renderMainMenu() {
  const m = document.createElement("div"); m.className = "menu centered";

  // Stats Row
  const stats = document.createElement("div"); stats.className = "stats-row";
  stats.innerHTML = `
    <div class="stat">Clips: <b>${formatNumber(state.clips)}</b></div>
    <div class="stat">Abos: <b>${formatNumber(state.subs)}</b></div>
    <div class="stat">Videos: <b>${state.videos.length}</b></div>
    ${state.playButtons.length>0?'<div class="stat boosted">+30% Boost!</div>':''}
  `;
  m.appendChild(stats);

  // Big Button
  const btn = document.createElement("button");
  btn.className = "main-btn";
  btn.title = "YouTube Clips sammeln!";
  btn.onclick = clickClip;
  btn.innerHTML = `<img src="${state.ytPic}" alt="Profil" onerror="this.src='${DEFAULT_PROFILE_PIC}'" />`;
  m.appendChild(btn);

  // Info
  const info = document.createElement("div");
  info.style.textAlign = "center";
  info.innerHTML = `<b>${state.ytName||"Kanalname"}</b><br><span style="font-size:1.08em">Klick auf dein Profilbild<br>für Clips!</span>`;
  m.appendChild(info);

  // Play-Buttons
  if (state.playButtons.length > 0) {
    const pbLine = document.createElement("div");
    pbLine.innerHTML = "Play-Buttons: ";
    state.playButtons.forEach(pb => {
      const found = BOOST_PLAY_BUTTONS.find(x=>x.label===pb);
      pbLine.innerHTML += `<span class="play-btn-badge" style="color:${found?found.color:'#fff'};border:1.5px solid ${found?found.color:'#fff'}">${pb}</span>`;
    });
    m.appendChild(pbLine);
  }

  // Latest Video
  if (state.videos.length>0) {
    const v = state.videos[state.videos.length-1];
    const div = document.createElement("div");
    div.style.marginTop = "18px";
    div.innerHTML = `Letztes Video: <b>${v.name}</b> <span style="font-size:.95em;">(+${formatNumber(v.abos)} Abos)</span>`;
    m.appendChild(div);
  }

  // Cut Video Button
  if (state.clips >= CLIPS_PER_VIDEO) {
    const cutBtn = document.createElement("button");
    cutBtn.className = "menu-btn";
    cutBtn.textContent = `Video schneiden (${CLIPS_PER_VIDEO} Clips)`;
    cutBtn.onclick = ()=>{ state.menu="cut"; render(); };
    m.appendChild(cutBtn);
  }

  gameDiv.appendChild(m);
}
function renderCutMenu() {
  const m = document.createElement("div"); m.className = "menu centered";
  m.innerHTML = `<h2>Video schneiden</h2>
    <div class="stat">Clips verfügbar: <b>${state.clips}</b></div>
  `;
  if (state.auto.cutter > 0) {
    m.innerHTML += `<div style="margin:10px 0">Cutting... <b>${state.auto.cutter.toFixed(1)}s</b> <progress max="1" value="0" id="cutprog" style="width:140px;"></progress></div>`;
    setTimeout(()=>{const p=document.getElementById("cutprog");if(p)p.value=1-state.auto.cutter/state._cutTotal;},100);
  } else if (state.clips>=CLIPS_PER_VIDEO) {
    // Start cut
    const cutBtn = document.createElement("button");
    cutBtn.className = "menu-btn";
    cutBtn.textContent = `Starte Schnitt (${CLIPS_PER_VIDEO} Clips)`;
    cutBtn.onclick = ()=>{ startCut(); };
    m.appendChild(cutBtn);
  } else {
    m.innerHTML += `<div>Mindestens ${CLIPS_PER_VIDEO} Clips nötig!</div>`;
  }
  // List videos
  if (state.videos.length>0) {
    m.innerHTML += "<h3>Deine Videos</h3>";
    const ul = document.createElement("ul"); ul.className = "video-list";
    state.videos.slice(-6).reverse().forEach(v=>{
      const li = document.createElement("li"); li.className = "video-item";
      li.innerHTML = `<b>${v.name}</b> <span style="font-size:.98em;">${formatNumber(v.abos)} Abos</span>`;
      ul.appendChild(li);
    });
    m.appendChild(ul);
  }
  // Back
  const back = document.createElement("button");
  back.className = "menu-btn";
  back.textContent = "Zurück";
  back.onclick = ()=>{ state.menu="main"; render(); };
  m.appendChild(back);
  gameDiv.appendChild(m);
}
function renderShopMenu() {
  const m = document.createElement("div"); m.className = "menu";
  m.innerHTML = `<h2>Shop</h2>`;
  const ul = document.createElement("ul"); ul.className = "shop-list";
  [
    {type:"clicker",label:"Klicker",desc:"Automatisch Clips sammeln",base:"Clips/sec"},
    {type:"cutter",label:"Cutter",desc:"Videos automatisch schneiden",base:"Cut-Speed"},
    {type:"streamer",label:"Streamer",desc:"Automatisch Twitch-Streams",base:"Streams/sec"},
    {type:"manager",label:"Manager",desc:"+5% Speed für alle",base:"Speed"}
  ].forEach(up=>{
    const price = Math.floor(state.shopPrices[up.type]);
    const lvl = state.upgrades[up.type];
    const li = document.createElement("li"); li.className = "shop-item";
    li.innerHTML = `<span><b>${up.label}</b> <span style="font-size:1em;">(Lv.${lvl})</span><br><span style="font-size:.97em;color:#aaa">${up.desc}</span></span>
      <span>
        <button onclick="buyUpgrade('${up.type}')">Kaufen<br>${price} Clips</button>
      </span>`;
    ul.appendChild(li);
  });
  m.appendChild(ul);

  // Info
  m.innerHTML += `<div style="margin-top:12px;color:#ddd;font-size:.95em">
    Jeder Klicker produziert +${getClickerPower()} Clips/sec.<br>
    Jeder Cutter beschleunigt Schnittzeit.<br>
    Jeder Streamer klickt Twitch.<br>
    Jeder Manager +5% Speed auf alles.<br>
    Preise steigen exponentiell.
  </div>`;

  // Back
  const back = document.createElement("button");
  back.className = "menu-btn";
  back.textContent = "Zurück";
  back.onclick = ()=>{ state.menu="main"; render(); };
  m.appendChild(back);

  gameDiv.appendChild(m);
}
function renderTwitchMenu() {
  const m = document.createElement("div"); m.className = "menu centered";
  m.innerHTML = `<h2>Twitch-Stream</h2>`;
  // Big Twitch button
  const btn = document.createElement("button");
  btn.className = "main-btn";
  btn.style.border = "3px solid var(--accent)";
  btn.title = "Twitch Abos sammeln!";
  btn.onclick = clickTwitch;
  btn.innerHTML = `<img src="${state.twPic}" alt="Twitch" onerror="this.src='${DEFAULT_TWITCH_PIC}'" />`;
  m.appendChild(btn);
  // Twitch stats
  m.innerHTML += `<div style="text-align:center"><b>${state.twName||"Twitch-Name"}</b><br>
    Twitch Klicks: <b>${formatNumber(state.twClicks)}</b><br>
    Twitch Abos: <b>${formatNumber(state.twSubs)}</b></div>`;
  // Back
  const back = document.createElement("button");
  back.className = "menu-btn";
  back.textContent = "Zurück";
  back.onclick = ()=>{ state.menu="main"; render(); };
  m.appendChild(back);

  gameDiv.appendChild(m);
}
function renderProfileMenu() {
  const m = document.createElement("div"); m.className = "menu centered";
  m.innerHTML = "<h2>Profil</h2>";
  // Profile Pic & Name
  m.innerHTML += `<img src="${state.ytPic}" class="profile-pic" id="profilePicShow" alt="Profilbild" onerror="this.src='${DEFAULT_PROFILE_PIC}'"/><br>`;
  m.innerHTML += `<div><b>YouTube:</b> ${state.ytName||"<span style='color:#bbb'>Kein Name</span>"} <button class="menu-btn" style="padding:3px 11px;font-size:.9em" onclick="editYTName()">Bearbeiten</button></div>`;
  m.innerHTML += `<button class="menu-btn" style="margin:8px 0 0 0" onclick="chooseProfilePic('yt')">Profilbild ändern</button>`;

  // Twitch
  m.innerHTML += `<hr style="width:80%;">`;
  m.innerHTML += `<img src="${state.twPic}" class="profile-pic" id="profilePicShowTwitch" style="border-color:var(--accent);" alt="Profilbild" onerror="this.src='${DEFAULT_TWITCH_PIC}'"/><br>`;
  m.innerHTML += `<div><b>Twitch:</b> ${state.twName||"<span style='color:#bbb'>Kein Name</span>"} <button class="menu-btn" style="padding:3px 11px;font-size:.9em" onclick="editTwitchName()">Bearbeiten</button></div>`;
  m.innerHTML += `<button class="menu-btn" style="margin:8px 0 0 0" onclick="chooseProfilePic('tw')">Profilbild ändern</button>`;

  // Profile Code
  if (!state.profileCode) state.profileCode = getRandomCode(10);
  m.innerHTML += `<div style="margin:18px 0 0 0">Dein Profil-Code:</div>
    <div class="code-box">${state.profileCode}</div>
    <div style="font-size:.92em;color:#aaa">Mit dem Code kannst du dein Profil auf einem anderen Gerät laden.</div>`;

  // Code eingeben
  m.innerHTML += `<div style="margin:19px 0 0 0">Profil laden:</div>
    <div class="input-block">
      <input type="text" id="loadCode" maxlength="15" placeholder="Profil-Code eingeben..." style="width:120px" />
      <button class="menu-btn" onclick="tryLoadProfile()">Laden</button>
    </div><div id="loadMsg" style="color:#e33;font-size:.95em"></div>`;

  // Reset button
  m.innerHTML += `<button class="menu-btn" style="margin:15px 0 0 0;background:#aa1111" onclick="resetGame()">Account löschen</button>`;

  // Back
  const back = document.createElement("button");
  back.className = "menu-btn";
  back.textContent = "Zurück";
  back.onclick = ()=>{ state.menu="main"; render(); };
  m.appendChild(back);

  gameDiv.appendChild(m);
}

/** --- Game Logic --- **/
function clickClip() {
  let boost = state.boosts;
  if (state.playButtons.length > 0) boost *= 1.3;
  state.clips += CLICKER_BASE * boost;
  saveState();
  render();
}
function clickTwitch() {
  let boost = state.boosts;
  if (state.playButtons.length > 0) boost *= 1.3;
  state.twClicks += STREAMCLICKS_BASE * boost;
  // Twitch Subs gain: random 1-6 per click, more if manager upgrades
  const base = 1 + Math.floor(Math.random()*6);
  const managerBonus = 1 + state.upgrades.manager*0.07;
  state.twSubs += Math.floor(base * managerBonus * boost);
  saveState();
  render();
}
function getClickerPower() {
  let power = state.upgrades.clicker * (1 + 0.25*state.upgrades.manager);
  if (state.playButtons.length > 0) power *= 1.3;
  return Math.max(0, Math.floor(power));
}
function getStreamerPower() {
  let power = state.upgrades.streamer * (1 + 0.22*state.upgrades.manager);
  if (state.playButtons.length > 0) power *= 1.3;
  return Math.max(0, Math.floor(power));
}
function getCutterSpeed() {
  let base = Math.pow(CUTTER_SPEED_FACTOR, state.upgrades.cutter);
  // Manager boost
  base *= Math.pow(1-MANAGER_SPEED_BOOST, state.upgrades.manager);
  if (state.playButtons.length > 0) base *= 0.7;
  return Math.max(0.25, base);
}
function buyUpgrade(type) {
  const price = Math.floor(state.shopPrices[type]);
  if (state.clips < price) return;
  state.clips -= price;
  state.upgrades[type]++;
  state.shopPrices[type] = state.shopPrices[type] * state.shopExp;
  saveState();
  render();
}
function startCut() {
  // How many clips to cut? Always CLIPS_PER_VIDEO
  const n = CLIPS_PER_VIDEO;
  if (state.clips < n) return;
  state.clips -= n;
  // Cutting time
  let time = CUT_TIME_BASE + CUT_TIME_PER_CLIP * n;
  time *= getCutterSpeed();
  state._cutTotal = time;
  state.auto.cutter = time;
  saveState();
  render();
}
function finishCut() {
  // Video naming prompt
  let name = prompt("Wie soll dein Video heißen?");
  if (!name) name = "Mein Video " + (state.videos.length+1);
  // Abos: random, plus Boni
  let abos = Math.floor(Math.random() * (180 + 60*state.upgrades.cutter)) + 20 + 8*state.upgrades.manager + 3*state.videos.length;
  if (state.playButtons.length > 0) abos = Math.floor(abos*1.3);
  state.subs += abos;
  // Lose some abos randomly
  let lost = 0;
  if (Math.random()<0.08 && state.subs>100) {
    lost = Math.floor(Math.random()*Math.min(45, state.subs/40));
    state.subs = Math.max(0, state.subs-lost);
    state.abosLost += lost;
  }
  state.videos.push({name, abos, lost});
  checkPlayButtons();
  checkTwitchUnlock();
  saveState();
  render();
}
function checkTwitchUnlock() {
  if (!state.twitchUnlocked && state.subs>=STREAM_UNLOCK_SUBS) {
    state.twitchUnlocked = true;
    state.menu = "twitch";
  }
}
function checkPlayButtons() {
  BOOST_PLAY_BUTTONS.forEach(pb=>{
    if (state.subs>=pb.subs && !state.playButtons.includes(pb.label))
      state.playButtons.push(pb.label);
  });
}
function resetGame() {
  if (confirm("Wirklich Account löschen?")) {
    Object.assign(state, clone(defaultState));
    state.profileCode = getRandomCode(10);
    saveState();
    render();
  }
}
function editYTName() {
  let n = prompt("Neuer YouTube-Kanalname:", state.ytName||"");
  if (n && n.length<25) {
    state.ytName = n;
    saveState();
    render();
  }
}
function editTwitchName() {
  let n = prompt("Neuer Twitch-Kanalname:", state.twName||"");
  if (n && n.length<25) {
    state.twName = n;
    saveState();
    render();
  }
}
function chooseProfilePic(which) {
  if (which==='yt')
    document.getElementById("profilePicInput").click();
  else
    document.getElementById("profilePicInputTwitch").click();
}
document.getElementById("profilePicInput").onchange = function(e) {
  const f = e.target.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    state.ytPic = ev.target.result;
    saveState();
    render();
  };
  reader.readAsDataURL(f);
};
document.getElementById("profilePicInputTwitch").onchange = function(e) {
  const f = e.target.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    state.twPic = ev.target.result;
    saveState();
    render();
  };
  reader.readAsDataURL(f);
};
function tryLoadProfile() {
  const code = document.getElementById("loadCode").value.trim().toUpperCase();
  const msg = document.getElementById("loadMsg");
  if (!code) { msg.innerText = "Bitte Code eingeben."; return; }
  if (importState(code)) {
    msg.innerText = "Profil geladen!";
    render();
  } else {
    msg.innerText = "Kein Profil mit diesem Code gefunden.";
  }
}

/** --- Game Loop/Automation --- **/
function tick(dt) {
  // Cutter
  if (state.auto.cutter > 0) {
    state.auto.cutter -= dt;
    if (state.auto.cutter <= 0) {
      state.auto.cutter = 0;
      finishCut();
    }
  }
  // Clicker automation
  if (state.upgrades.clicker > 0) {
    let power = getClickerPower();
    state.clips += power * dt;
  }
  // Streamer
  if (state.upgrades.streamer > 0 && state.twitchUnlocked) {
    let power = getStreamerPower();
    state.twClicks += power * dt;
    // Twitch subs gain
    state.twSubs += Math.floor(power * (1 + 0.07*state.upgrades.manager) * dt * (state.playButtons.length>0?1.3:1));
  }
  exportState();
  saveState();
  render();
}
setInterval(()=>tick(1), 1000);

/** --- Startup --- **/
window.buyUpgrade = buyUpgrade;
window.editYTName = editYTName;
window.editTwitchName = editTwitchName;
window.chooseProfilePic = chooseProfilePic;
window.tryLoadProfile = tryLoadProfile;
window.resetGame = resetGame;

render();
</script>
</body>
</html>
