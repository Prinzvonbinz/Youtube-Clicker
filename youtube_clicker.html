<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>YouTube & Twitch Clicker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    :root { --main:#ff0000; --twitch:#9147ff; --bg:#191c22; --btn:#fff; --btn-hover:#eee; --text:#fff; --accent:#ffd700;}
    html,body { margin:0; padding:0; font-family:sans-serif; background:var(--bg); color:var(--text); min-height:100vh;}
    .center { display: flex; flex-direction: column; align-items: center; justify-content: center;}
    .main-btn { border:none; border-radius:50%; width:160px; height:160px; margin:30px auto; box-shadow:0 4px 24px #0008; background:var(--btn); display:flex; align-items:center; justify-content:center; font-size:2.2rem; transition:.15s; cursor:pointer; position:relative;}
    .main-btn img { width:75%; height:75%; object-fit:cover; border-radius:50%;}
    .main-btn:active { transform: scale(0.97);}
    .menu-btn {margin:6px 4px;padding:10px 18px;border-radius:8px;font-size:1.05rem;border:none;background:var(--btn);color:var(--main);font-weight:700;transition:.1s;cursor:pointer;}
    .menu-btn.active, .menu-btn:hover {background:var(--main);color:#fff;}
    .shop-item {display:flex;justify-content:space-between;align-items:center;background:#282828;margin:8px 0;padding:11px 16px;border-radius:9px;}
    .shop-item .shop-upg {margin-left:7px;}
    .shop-btn {padding:7px 18px;border-radius:7px;background:var(--main);color:#fff;font-weight:700;border:none;cursor:pointer;}
    .shop-btn:disabled {background:#aaa;}
    .profile-img {width:64px; height:64px; border-radius:50%; object-fit:cover; border:2px solid var(--main); margin:10px;}
    .input-row {display:flex;align-items:center;margin:12px 0;}
    .input-row label {margin-right:7px;}
    .videos-list {max-height:135px;overflow-y:auto;background:#222;padding:9px 0 0 0;border-radius:8px;}
    .video-item {padding:6px 12px;border-bottom:1px solid #333;}
    .video-item:last-child{border:none;}
    .play-btn {background:var(--accent);color:var(--main);font-weight:700;border:none;padding:7px 16px;border-radius:7px;box-shadow:0 2px 12px #0005;}
    .cut-progress {height:13px;background:#fff2;width:100%;border-radius:7px;margin:10px 0;}
    .cut-bar {height:100%;background:var(--main);border-radius:7px;transition:width .3s;}
    .stat {margin:6px;font-size:1.13rem;}
    .code-row {word-break:break-all;font-size:.95rem;}
    .hide {display:none;}
    @media (max-width: 700px) {
      .main-btn {width:120px;height:120px;}
      .profile-img {width:48px;height:48px;}
    }
  </style>
</head>
<body>
<div id="app"></div>
<script>
const defaultData = {
  ytName:"", ytImg:"", twName:"", twImg:"", code:"", clips:0, videos:[], subs:0, lost:0, cut:{working:false,progress:0,clips:0,name:""}, 
  upgrades:{clicker:0, cutter:0, streamer:0, manager:0}, shopPrices:{clicker:20,cutter:50,streamer:300,manager:900},
  cutBase:10, playBtns:[], twitch:false, twitchClicks:0, twitchUnlock:10000
};
let data = {};
let state = {menu:"main"};
let cutTimer, clickerTimer, streamerTimer, cutterTimer, managerBuff=0;

function save(){localStorage.setItem("ytclicker",JSON.stringify(data));}
function load(){let d=localStorage.getItem("ytclicker"); data=d?JSON.parse(d):structuredClone(defaultData);}
function reset(){localStorage.removeItem("ytclicker");location.reload();}
function genCode(){return Math.random().toString(36).substr(2,12);}
function updateCode(){data.code=genCode();}
function setProfile(img,yt=true){if(yt)data.ytImg=img;else data.twImg=img;save();render();}
function setName(n,yt=true){if(yt)data.ytName=n;else data.twName=n;save();render();}
function toMenu(m){state.menu=m;render();}
function btnClass(m){return state.menu==m?'menu-btn active':'menu-btn';}
function unlockTwitch(){if(!data.twitch && data.subs>=data.twitchUnlock){data.twitch=true;save();}}
function playBtnBoost(){return 1+0.3*data.playBtns.length;}
function managerBoost(){return 1+0.05*data.upgrades.manager;}
function clickGain(){return Math.floor((1+data.upgrades.clicker)*managerBoost()*playBtnBoost());}
function twitchGain(){return Math.floor((1+data.upgrades.streamer)*managerBoost()*playBtnBoost());}
function calcShopPrice(item){return Math.floor(data.shopPrices[item]*Math.pow(1.65,data.upgrades[item]));}
function addClips(n){data.clips+=n;save();render();}
function buyUpg(item){
  let price=calcShopPrice(item);
  if(data.clips>=price){
    data.clips-=price;
    data.upgrades[item]++;
    save(); render();
  }
}
function startCut(clips){if(clips>data.clips)return;data.cut={working:true,progress:0,clips, name:""};data.clips-=clips;save();render();progressCut();}
function progressCut(){
 if(!data.cut.working)return;
 let speed=(data.cutBase-Math.min(7,data.upgrades.cutter))*managerBoost()/playBtnBoost();
 let duration = Math.max(3,Math.ceil(data.cut.clips*speed/10));
 let t=0;
 cutTimer=setInterval(()=>{
   t++; data.cut.progress=Math.floor(100*t/duration);
   render();
   if(t>=duration){
     clearInterval(cutTimer);
     toMenu("cutName");
   }
 },400);
}
function finishCut(name){
  data.videos.push({name,clips:data.cut.clips,date:new Date().toLocaleDateString(),subs:0});
  data.cut={working:false,progress:0,clips:0,name:""};
  save();render();toMenu("main");
}
function uploadVid(idx){
  let v=data.videos[idx];
  let base=25+Math.floor(Math.sqrt(v.clips)*10);
  let gain=Math.floor(base * managerBoost()*playBtnBoost());
  v.subs+=gain;
  data.subs+=gain;
  if(Math.random()<0.09)data.lost+=Math.floor(gain*0.2),data.subs-=Math.floor(gain*0.2);
  unlockTwitch();save();render();
}
function collectPlayBtn(){if(data.playBtns.length<5){
  data.playBtns.push({date:new Date().toLocaleDateString(),subs:data.subs});
  save();render();
}}
function autoClicker(){if(clickerTimer)clearInterval(clickerTimer);
  if(data.upgrades.clicker>0)
    clickerTimer=setInterval(()=>{addClips(clickGain());},1100/managerBoost());}
function autoStreamer(){if(streamerTimer)clearInterval(streamerTimer);
  if(data.twitch && data.upgrades.streamer>0)
    streamerTimer=setInterval(()=>{data.twitchClicks+=twitchGain();data.subs+=twitchGain();save();render();},1350/managerBoost());}
function autoCutter(){if(cutterTimer)clearInterval(cutterTimer);
  if(data.upgrades.cutter>0)
    cutterTimer=setInterval(()=>{if(!data.cut.working&&data.clips>=10)startCut(10);},6000/managerBoost());}
function allTimers(){autoClicker();autoStreamer();autoCutter();}
function importAcc(code){
  let acc=localStorage.getItem("ytclicker-"+code);
  if(acc){localStorage.setItem("ytclicker",acc);load();save();render();}
}
function exportAcc(){localStorage.setItem("ytclicker-"+data.code,JSON.stringify(data));}
function handleProfileImg(ev,yt=true){
  let file=ev.target.files[0];if(!file)return;
  let r=new FileReader();
  r.onload=(e)=>{setProfile(e.target.result,yt);}
  r.readAsDataURL(file);
}
function render(){
  exportAcc();
  unlockTwitch();
  allTimers();
  let html = `
  <div class="center" style="padding:12px;">
    <div>
      <button class="${btnClass('main')}" onclick="toMenu('main')">YouTube</button>
      <button class="${btnClass('cut')}" onclick="toMenu('cut')">Cut</button>
      <button class="${btnClass('shop')}" onclick="toMenu('shop')">Shop</button>
      ${data.twitch?`<button class="${btnClass('twitch')}" onclick="toMenu('twitch')">Twitch</button>`:""}
      <button class="${btnClass('profile')}" onclick="toMenu('profile')">Profil</button>
    </div>
  `;

  // Main
  if(state.menu=="main"){
    html+=`
    <div class="center">
      <div style="margin:18px;">
        <span class="stat">Clips: <b>${data.clips}</b></span>
        <span class="stat">Abos: <b>${data.subs}</b> ${data.lost?`<span style="color:#f45;">(-${data.lost})</span>`:""}</span>
        <span class="stat">Play-Buttons: <b>${data.playBtns.length}</b></span>
      </div>
      <button class="main-btn" onclick="addClips(clickGain())" title="Click for Clips">
        ${data.ytImg?`<img src="${data.ytImg}">`:`<svg width="70" height="70"><circle cx="35" cy="35" r="34" fill="#ff0000"/><polygon points="28,20 55,35 28,50" fill="#fff"/></svg>`}
      </button>
      <div class="stat">Clips/Klick: <b>${clickGain()}</b></div>
      <div style="margin:15px 0;">
        <button class="play-btn" onclick="collectPlayBtn()">ðŸŽ‰ Play-Button abholen</button>
      </div>
      <div>
        <h3>Videos</h3>
        <div class="videos-list">${data.videos.map((v,i)=>`
          <div class="video-item">
            <b>${v.name||"Unbenannt"}</b> | Clips: ${v.clips} | Abos: ${v.subs}
            <button onclick="uploadVid(${i})" class="menu-btn">Hochladen</button>
          </div>`).join('') || "<div class='stat'>Keine Videos</div>"}
        </div>
      </div>
    </div>
    `;
  }
  // Cut Menu
  else if(state.menu=="cut"){
    html+=`
    <div class="center">
      <h3>Clips verarbeiten</h3>
      ${data.cut.working?`
        <div>
          <div class="cut-progress"><div class="cut-bar" style="width:${data.cut.progress}%"></div></div>
          <div>Schneide ${data.cut.clips} Clips...</div>
        </div>
      `:`
        <div class="input-row">
          <label>Clips:</label>
          <input id="cut-amount" type="number" min="5" max="${data.clips}" value="10" style="width:60px;">
          <button class="menu-btn" onclick="startCut(parseInt(document.getElementById('cut-amount').value)||0)">Start</button>
        </div>
      `}
    </div>
    `;
    // Cut Naming
    if(state.menu=="cutName"||data.cut.progress>=100){
      html+=`
      <div class="center">
        <h4>Video benennen</h4>
        <input id="vidname" placeholder="Videoname" maxlength="24" style="padding:6px 11px;">
        <button class="menu-btn" onclick="finishCut(document.getElementById('vidname').value)">Speichern</button>
      </div>
      `;
    }
  }
  // Shop
  else if(state.menu=="shop"){
    html+=`<div class="center" style="max-width:430px;">
      <h3>Shop</h3>
      ${["clicker","cutter","streamer","manager"].map(item=>`
        <div class="shop-item">
          <span>${{
            clicker:"Klicker", cutter:"Cutter", streamer:"Streamer", manager:"Manager"
          }[item]} (Lv. ${data.upgrades[item]})</span>
          <div>
            <button class="shop-btn" onclick="buyUpg('${item}')" ${data.clips<calcShopPrice(item)?"disabled":""}>Kaufen<br>${calcShopPrice(item)} Clips</button>
            <span class="shop-upg">${item=="manager"?"+5% Speed": item=="clicker"?"+1 Clip/s":item=="cutter"?"schneller schneiden":"Twitch-Streams"}</span>
          </div>
        </div>
      `).join('')}
    </div>`;
  }
  // Twitch
  else if(state.menu=="twitch"){
    html+=`
    <div class="center">
      <h3>Twitch</h3>
      <span class="stat">Twitch-Klicks: <b>${data.twitchClicks}</b></span>
      <button class="main-btn" onclick="data.twitchClicks+=twitchGain();data.subs+=twitchGain();save();render();" title="Twitch Click">
        ${data.twImg?`<img src="${data.twImg}">`:`<svg width="65" height="65"><rect x="5" y="15" width="55" height="40" rx="10" fill="#9147ff"/><text x="18" y="45" fill="#fff" font-size="32">T</text></svg>`}
      </button>
      <div class="stat">Klicks/Click: <b>${twitchGain()}</b></div>
      <div class="input-row">
        <label>Kanalname:</label>
        <input id="twname" value="${data.twName||""}" maxlength="18" style="padding:5px 9px;" onblur="setName(this.value,false)">
      </div>
      <div class="input-row">
        <label>Profilbild:</label>
        <input type="file" accept="image/*" style="width:130px;" onchange="handleProfileImg(event,false)">
        ${data.twImg?`<img src="${data.twImg}" class="profile-img">`:""}
      </div>
    </div>
    `;
  }
  // Profile
  else if(state.menu=="profile"){
    html+=`
    <div class="center" style="max-width:410px;">
      <h3>Profil</h3>
      <div>
        <div class="input-row">
          <label>YouTube Name:</label>
          <input id="ytname" value="${data.ytName||""}" maxlength="18" style="padding:5px 9px;" onblur="setName(this.value,true)">
        </div>
        <div class="input-row">
          <label>Profilbild:</label>
          <input type="file" accept="image/*" onchange="handleProfileImg(event,true)">
          ${data.ytImg?`<img src="${data.ytImg}" class="profile-img">`:""}
        </div>
      </div>
      <div class="input-row">
        <label>Dein Account-Code:</label>
        <span class="code-row" style="background:#282828;padding:4px 11px;border-radius:6px;">${data.code}</span>
      </div>
      <div class="input-row">
        <label>Account laden:</label>
        <input id="acc-code" maxlength="16" style="padding:5px 9px;">
        <button class="menu-btn" onclick="importAcc(document.getElementById('acc-code').value)">Laden</button>
      </div>
      <div class="input-row">
        <button class="menu-btn" onclick="reset()">Account lÃ¶schen</button>
      </div>
    </div>
    `;
  }
  html+="</div>";
  document.getElementById("app").innerHTML=html;
}

// Initialisierung
window.toMenu=toMenu;
window.addClips=addClips;
window.uploadVid=uploadVid;
window.startCut=startCut;
window.finishCut=finishCut;
window.buyUpg=buyUpg;
window.setName=setName;
window.setProfile=setProfile;
window.handleProfileImg=handleProfileImg;
window.importAcc=importAcc;
window.reset=reset;
window.collectPlayBtn=collectPlayBtn;
window.render=render;

load();
if(!data.code)updateCode();
render();
</script>
</body>
</html>
