<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <title>YouTube Clicker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root {
      --rot: #ff2222;
      --violett: #9147ff;
      --grau: #252525;
      --dunkel: #181818;
      --gelb: #ffc700;
      --border: #333;
      --radius: 1em;
      --shadow: 0 4px 32px #0007;
      --transition: .16s;
    }
    html, body {
      margin:0; padding:0; background:var(--dunkel); color:#fff;
      font-family:'Segoe UI',Arial,sans-serif;
      min-height:100vh;
    }
    #app { max-width:440px; margin:0 auto; padding: 1.2em 0.7em;}
    h1, h2 { text-align:center; margin:.7em 0 .3em;}
    nav {
      display:flex; flex-wrap:wrap; justify-content:center; gap:.4em;
      margin-bottom:1.2em;
    }
    nav button {
      background:var(--grau); color:#fff;
      border:none; border-radius:.7em;
      padding:.6em 1.3em; font-size:1.1em; cursor:pointer;
      margin:.1em 0;
      box-shadow:var(--shadow);
      transition:background var(--transition), color var(--transition);
    }
    nav button.active, nav button:hover { background:var(--rot); color:#fff; }
    .menu { display:none; animation:fadein .3s; }
    .menu.active { display:block; }
    .center { display:flex; flex-direction:column; align-items:center; }
    .big-btn {
      margin:1.2em auto .5em; padding:0; border:none; background:none; cursor:pointer;
      display:block; width:160px; height:160px;
      border-radius:50%; box-shadow:0 6px 32px #000a;
      border:8px solid var(--rot); background:#1d1d1d;
      transition:border .16s, box-shadow .12s;
    }
    .big-btn.tw { border-color:var(--violett);}
    .big-btn:active { border-color:var(--gelb); box-shadow:0 0 0 10px #ffc70055;}
    .big-btn img {
      width:100%; height:100%; border-radius:50%; object-fit:cover;
      background:#262626;
    }
    .stat-row {
      display:flex; justify-content:space-between; margin:.4em 0; gap:1em;
    }
    .boost { color:var(--gelb); font-weight:bold;}
    .shop-list, .video-list { display:flex; flex-direction:column; gap:.7em; margin-top:.5em;}
    .shop-item, .video-item {
      background:#222; border-radius:.7em; padding:.7em 1em;
      display:flex; justify-content:space-between; align-items:center;
      box-shadow:0 2px 10px #0003;
    }
    .shop-item .info{ flex:1; }
    .shop-item button {
      background:var(--rot); color:#fff; border:none; border-radius:.4em;
      padding:.5em 1.1em; font-size:1em; font-weight:bold; cursor:pointer;
      transition:background .14s;
    }
    .shop-item button:active { background:var(--gelb); color:var(--dunkel);}
    .cut-bar { width:100%; height:14px; background:#232323; border-radius:7px; margin:.8em 0;
      overflow:hidden; box-shadow:0 2px 12px #0004;}
    .cut-progress { height:100%; background:var(--rot); transition:width .14s;}
    input, textarea {
      background:#161616; color:#fff; border:1.5px solid #444; border-radius:.4em;
      font-size:1em; padding:.5em .9em; margin-bottom:.7em; width:100%; box-sizing:border-box;
      transition:border .13s;
    }
    input:focus, textarea:focus { border:1.5px solid var(--rot);}
    .profile-pic-btn {
      border:none; background:none; cursor:pointer; padding:0;
    }
    .profile-pic-btn img {
      width:80px; height:80px; border-radius:50%; margin-bottom:.35em;
      border:5px solid var(--rot); background:#222; object-fit:cover;
      box-shadow:0 3px 16px #0006;
    }
    .profile-pic-btn.tw img { border-color:var(--violett);}
    .profile-pic-btn:active img, .profile-pic-btn:focus img { border-color:var(--gelb);}
    .profile-block {display:flex;align-items:center;gap:1em; justify-content:center;}
    .play-buttons { margin:.7em 0;}
    .play-btn {
      display:inline-block; background:var(--gelb); color:var(--dunkel); border-radius:.7em;
      margin:0 .2em; padding:.15em .55em; font-weight:bold;
      font-size:1.12em; box-shadow:0 2px 8px #0003;
    }
    .error { color:#f66; }
    @media (max-width:600px){
      .big-btn { width:110px; height:110px;}
      #app {padding:.5em;}
    }
    @keyframes fadein {from{opacity:0;} to{opacity:1;}}
  </style>
</head>
<body>
  <div id="app"></div>
  <input id="fileInput" type="file" accept="image/*" style="display:none"/>
  <script>
    // ---- GAME STATE ----
    const PLAY_BUTTONS = [
      {subs: 100000, name: "Silber"},
      {subs: 1000000, name: "Gold"},
      {subs: 10000000, name: "Diamant"}
    ];
    let state = {
      profile: {
        ytName: "", ytPic: "", twName: "", twPic: "",
        code: randomCode(),
      },
      clips: 0,
      videos: [],
      abos: 0,
      lostAbos: 0,
      twitchAbos: 0,
      playButtons: [],
      upgrades: { cutter:0, clicker:0, streamer:0, manager:0 },
      shop: { cutter:60, clicker:30, streamer:100, manager:900 },
      cutMenu: { open:false, clipsToCut:0, progress:0, cutting:false, videoName:"" },
      twitchUnlocked: false,
      currentMenu: "start"
    };

    // ---- STORAGE ----
    function save() {
      try {
        // Kürze auf 20 Zeichen: Base36, nur das Minimum speichern
        let min = {
          p: state.profile,
          c: state.clips,
          v: state.videos,
          a: state.abos,
          l: state.lostAbos,
          t: state.twitchAbos,
          pb: state.playButtons,
          u: state.upgrades,
          s: state.shop,
          tu: state.twitchUnlocked
        };
        localStorage.setItem("ytclicker_save", encode(min));
      } catch {}
    }
    function load() {
      try {
        const s = localStorage.getItem("ytclicker_save");
        if(!s) return;
        const obj = decode(s);
        state.profile = obj.p; state.clips = obj.c; state.videos = obj.v;
        state.abos = obj.a; state.lostAbos = obj.l; state.twitchAbos = obj.t;
        state.playButtons = obj.pb; state.upgrades = obj.u; state.shop = obj.s;
        state.twitchUnlocked = obj.tu ?? false;
      } catch {}
    }
    function exportCode() {
      // Max 20 Zeichen (Base36, komprimiert)
      return encode({
        p: state.profile, c: state.clips, v: state.videos,
        a: state.abos, l: state.lostAbos, t: state.twitchAbos,
        pb: state.playButtons, u: state.upgrades, s: state.shop, tu: state.twitchUnlocked
      });
    }
    function importCode(code) {
      try {
        const obj = decode(code.trim());
        if(obj && obj.p && obj.p.ytName) {
          state.profile = obj.p; state.clips = obj.c; state.videos = obj.v;
          state.abos = obj.a; state.lostAbos = obj.l; state.twitchAbos = obj.t;
          state.playButtons = obj.pb; state.upgrades = obj.u; state.shop = obj.s;
          state.twitchUnlocked = obj.tu ?? false;
          save(); render();
          alert("Account geladen!");
        } else alert("Ungültiger Code!");
      } catch { alert("Ungültiger Code!"); }
    }
    function randomCode() {
      return Math.random().toString(36).substr(2, 10).toUpperCase();
    }
    // -- komprimiert auf <20 Zeichen (Base36, JSON min) --
    function encode(obj) {
      let str = JSON.stringify(obj);
      return btoa(unescape(encodeURIComponent(str))).replace(/=+$/,"").substr(0,20);
    }
    function decode(code) {
      code = code.replace(/[^A-Za-z0-9+\/]/g,"");
      return JSON.parse(decodeURIComponent(escape(atob(code))));
    }

    // ---- GAME LOGIC ----
    function getClickValue() {
      let base = 1 + state.upgrades.clicker;
      let boost = 1 + 0.3 * state.playButtons.length;
      let manager = 1 + state.upgrades.manager * 0.05;
      return Math.floor(base * boost * manager);
    }
    function getStreamerValue() {
      let base = 1 + state.upgrades.streamer;
      let boost = 1 + 0.3 * state.playButtons.length;
      let manager = 1 + state.upgrades.manager * 0.05;
      return Math.floor(base * boost * manager);
    }
    function getCutTime(clips) {
      let base = 3000 + clips * 500;
      let cutter = state.upgrades.cutter;
      let manager = 1 + state.upgrades.manager * 0.05;
      let boost = 1 + 0.3 * state.playButtons.length;
      let time = base / (1 + cutter) / manager / boost;
      return Math.max(1000, time);
    }
    function getAboGain(videos) {
      let base = 3 + Math.floor(Math.random() * 3);
      let multi = 1 + Math.floor(videos/8);
      let boost = 1 + 0.3 * state.playButtons.length;
      let loss = Math.random() < 0.18 ? -Math.floor(Math.random()*2+1) : 0;
      return Math.max(0, Math.floor(base * multi * boost) + loss);
    }
    function getTwitchAboGain() {
      let base = 1 + state.upgrades.streamer;
      let boost = 1 + 0.3 * state.playButtons.length;
      let manager = 1 + state.upgrades.manager * 0.05;
      return Math.floor(base * boost * manager);
    }
    function getShopPrice(item) {
      const bases = {cutter:60, clicker:30, streamer:100, manager:900};
      const n = state.upgrades[item];
      return Math.floor(bases[item] * Math.pow(1.65, n));
    }
    function buyUpgrade(item) {
      const price = getShopPrice(item);
      if(state.clips < price) return;
      state.clips -= price;
      state.upgrades[item]++;
      state.shop[item] = getShopPrice(item);
      save(); render();
    }
    function addPlayButton() {
      const next = PLAY_BUTTONS[state.playButtons.length];
      if(!next) return;
      if(state.abos >= next.subs && !state.playButtons.includes(next.name)) {
        state.playButtons.push(next.name);
        alert(`Du hast den ${next.name}-Play-Button freigeschaltet! +30% Boost!`);
        save(); render();
      }
    }
    function unlockTwitch() {
      if(!state.twitchUnlocked && state.abos >= 15000) {
        state.twitchUnlocked = true;
        alert("Twitch-Menü freigeschaltet!");
        save(); render();
      }
    }
    function getDefaultPic(type) {
      return type==="tw"
        ? "https://static-cdn.jtvnw.net/jtv_user_pictures/xarth/404_user_70x70.png"
        : "https://yt3.ggpht.com/ytc/AGIKgqP-0fP7vN5J2Z0jSsI7ilQwZLv1w6k2jYv1h2SpQ=s88-c-k-c0x00ffffff-no-rj";
    }

    // ---- RENDER ----
    function render() {
      save();
      const app = document.getElementById("app");
      // Navigation
      let menus = [
        {id:"home", label:"YouTube", icon:"🎬"},
        {id:"cut", label:"Cut", icon:"✂️"},
        {id:"videos", label:"Videos", icon:"📺"},
        {id:"shop", label:"Shop", icon:"🛒"},
        {id:"profile", label:"Profil", icon:"👤"}
      ];
      if(state.twitchUnlocked)
        menus.splice(1,0,{id:"twitch",label:"Twitch",icon:"🟪"});
      app.innerHTML = `
      ${state.currentMenu!=="start"?`
        <nav>
          ${menus.map(m => `
            <button class="${state.currentMenu===m.id?'active':''}" onclick="switchMenu('${m.id}')">
              ${m.icon} ${m.label}
            </button>
          `).join("")}
        </nav>
      `:""}
      ${state.currentMenu==="start"?renderStartMenu():""}
      ${menus.map(m => `
        <div class="menu ${state.currentMenu===m.id?'active':''}" id="menu-${m.id}">
          ${renderMenu(m.id)}
        </div>
      `).join("")}
      `;
    }
    function renderMenu(id) {
      switch(id) {
        case "home": return renderHome();
        case "twitch": return renderTwitch();
        case "cut": return renderCut();
        case "shop": return renderShop();
        case "videos": return renderVideos();
        case "profile": return renderProfile();
        default: return "";
      }
    }
    function renderStartMenu() {
      return `
        <h2>YouTube Clicker</h2>
        <div class="center" style="gap:.8em;">
          <button class="profile-pic-btn" onclick="editProfilePic('yt')">
            <img src="${state.profile.ytPic||getDefaultPic('yt')}" alt="Profilbild"/>
          </button>
          <input id="ytName" value="${state.profile.ytName||""}" placeholder="YouTube Kanalname" maxlength="22"/>
          <button onclick="startGame()" style="font-size:1.2em;margin-top:.8em;">Starten</button>
        </div>
      `;
    }
    function renderHome() {
      return `
      <div class="center">
        <button class="big-btn" onclick="ytClick()" title="Clips sammeln" aria-label="Clips">
          <img src="${state.profile.ytPic||getDefaultPic('yt')}" alt="YT Profilbild"/>
        </button>
        <div class="stat-row"><span>Clips:</span><b>${state.clips}</b></div>
        <div class="stat-row"><span>Abonnenten:</span><b>${state.abos}</b></div>
        <div class="play-buttons">
          ${state.playButtons.map(pb=>`<span class="play-btn">${pb}</span>`).join("")}
        </div>
        <div style="margin:1.2em 0;">
          <button onclick="openCutMenu()" style="font-size:1em;">Clips zu Video schneiden</button>
        </div>
      </div>
      `;
    }
    function renderTwitch() {
      return `
      <div class="center">
        <button class="big-btn tw" onclick="twClick()" title="Twitch-Abos sammeln">
          <img src="${state.profile.twPic||getDefaultPic('tw')}" alt="TW Profilbild"/>
        </button>
        <div class="stat-row"><span>Twitch-Abonnenten:</span><b>${state.twitchAbos}</b></div>
        <div style="margin:1.2em 0;">
          <small>Klicke auf das Twitch-Profilbild für mehr Twitch-Abos!</small>
        </div>
      </div>
      `;
    }
    function renderCut() {
      if(!state.cutMenu.open) {
        return `
        <div class="center">
          <h3>Clips schneiden</h3>
          <div class="stat-row"><span>Verfügbare Clips:</span><b>${state.clips}</b></div>
          <input id="clipsToCut" type="number" min="1" max="${state.clips}" value="5" style="max-width:7em;"/>
          <input id="videoName" placeholder="Videoname" maxlength="22"/>
          <button onclick="startCutting()">Video schneiden</button>
        </div>
        `;
      } else {
        return `
        <div class="center">
          <h3>Video wird geschnitten...</h3>
          <div class="stat-row"><span>Clips:</span><b>${state.cutMenu.clipsToCut}</b></div>
          <div class="cut-bar"><div class="cut-progress" style="width:${state.cutMenu.progress*100}%;"></div></div>
          <div>${Math.round(state.cutMenu.progress*100)}%</div>
        </div>
        `;
      }
    }
    function renderShop() {
      const items = [
        {
          id: "clicker", name:"Klicker",
          desc:"Klickt automatisch Clips."
        },
        {
          id: "cutter", name:"Cutter",
          desc:"Schneidet Videos automatisch (schneller mit Upgrades)."
        },
        {
          id: "streamer", name:"Streamer",
          desc:"Klickt automatisch den Twitch-Button."
        },
        {
          id: "manager", name:"Manager",
          desc:"Gibt allen +5% Speed/Upgrade."
        }
      ];
      return `
      <h3>Shop</h3>
      <div class="shop-list">
        ${items.map(item => `
          <div class="shop-item">
            <div class="info">
              <b>${item.name} (Lvl ${state.upgrades[item.id]})</b>
              <div style="font-size:.97em;">${item.desc}</div>
            </div>
            <button onclick="buyUpgrade('${item.id}')">Kaufen (${state.shop[item.id]} Clips)</button>
          </div>
        `).join("")}
      </div>
      `;
    }
    function renderVideos() {
      if(!state.videos.length) return `<div>Keine Videos vorhanden.</div>`;
      return `
        <h3>Deine Videos</h3>
        <div class="video-list">
          ${state.videos.map(v => `
            <div class="video-item">
              <span><b>${v.name}</b> (${v.clips} Clips)</span>
              <span>${v.abos>0?`+${v.abos}`:""} Abos</span>
            </div>
          `).join("")}
        </div>
      `;
    }
    function renderProfile() {
      return `
      <div>
        <h3>Profil</h3>
        <div class="profile-block">
          <button class="profile-pic-btn" onclick="editProfilePic('yt')">
            <img src="${state.profile.ytPic||getDefaultPic('yt')}" alt="YT Profilbild"/>
          </button>
          <input id="ytName2" value="${state.profile.ytName||""}" placeholder="YouTube Kanalname" maxlength="22"
            oninput="onProfileNameChange('yt', this.value)"/>
        </div>
        <div class="profile-block" style="margin:1em 0;">
          <button class="profile-pic-btn tw" onclick="editProfilePic('tw')">
            <img src="${state.profile.twPic||getDefaultPic('tw')}" alt="Twitch Profilbild"/>
          </button>
          <input id="twName2" value="${state.profile.twName||""}" placeholder="Twitch Kanalname" maxlength="22"
            oninput="onProfileNameChange('tw', this.value)"/>
        </div>
        <div class="stat-row" style="margin-top:.8em;"><span>Account-Code:</span>
          <input style="width:120px;display:inline;" value="${state.profile.code}" readonly/>
        </div>
        <div style="margin:.7em 0;">
          <button onclick="copyProfileCode()">Code kopieren</button>
        </div>
        <div style="margin:.5em 0;">
          <input id="importCode" placeholder="Account-Code einfügen"/>
          <button onclick="importProfileCode()">Account laden</button>
        </div>
        <div style="margin-top:1.2em;">
          <button onclick="resetGame()" style="background:#f44;">Zurücksetzen</button>
        </div>
      </div>
      `;
    }

    // ---- EVENTS ----
    window.switchMenu = function(id) {
      state.currentMenu = id;
      render();
    };
    window.ytClick = function() {
      const gain = getClickValue();
      state.clips += gain;
      save(); render();
    };
    window.twClick = function() {
      if(!state.twitchUnlocked) return;
      const gain = getTwitchAboGain();
      state.twitchAbos += gain;
      save(); render();
    };
    window.buyUpgrade = function(item) { buyUpgrade(item); };
    window.openCutMenu = function() { switchMenu('cut'); };
    window.startCutting = function() {
      const clips = Number(document.getElementById('clipsToCut').value);
      const name = document.getElementById('videoName').value.trim()||`Video #${state.videos.length+1}`;
      if(isNaN(clips) || clips<1 || clips>state.clips) { alert("Ungültige Clips-Anzahl!"); return; }
      state.cutMenu = { open:true, clipsToCut:clips, progress:0, cutting:true, videoName:name };
      state.clips -= clips;
      render();
      doCutProgress();
    };
    function doCutProgress() {
      let steps = 60, i = 0;
      let total = getCutTime(state.cutMenu.clipsToCut);
      function frame() {
        if(!state.cutMenu.cutting) return;
        i++; state.cutMenu.progress = Math.min(1, i/steps);
        render();
        if(i<steps) setTimeout(frame, total/steps);
        else {
          state.cutMenu.open = false; state.cutMenu.cutting = false; state.cutMenu.progress = 0;
          // Video fertig
          const abos = getAboGain(state.videos.length);
          state.videos.push({name:state.cutMenu.videoName,clips:state.cutMenu.clipsToCut,abos:abos});
          state.abos += abos;
          state.lostAbos += abos<0?Math.abs(abos):0;
          addPlayButton();
          unlockTwitch();
          save(); render();
          alert(`Video "${state.cutMenu.videoName}" hochgeladen! ${abos>=0?"+":""}${abos} Abos!`);
        }
      }
      frame();
    }
    window.editProfilePic = function(type) {
      pickProfilePic(img => {
        state.profile[type+'Pic'] = img;
        save(); render();
      });
    };
    window.onProfileNameChange = function(type, val) {
      state.profile[type+'Name'] = val.replace(/[^a-zA-Z0-9 äöüÄÖÜß._-]/g,"");
      save();
    };
    window.copyProfileCode = function() {
      navigator.clipboard.writeText(state.profile.code);
      alert("Code kopiert!");
    };
    window.importProfileCode = function() {
      const code = document.getElementById('importCode').value.trim();
      if(code) importCode(code);
    };
    window.resetGame = function() {
      if(confirm("Account wirklich zurücksetzen?")) {
        localStorage.removeItem("ytclicker_save");
        location.reload();
      }
    };
    window.startGame = function() {
      const ytName = document.getElementById('ytName').value.trim();
      if(!ytName) { alert("Bitte Kanalnamen eingeben!"); return; }
      state.profile.ytName = ytName.replace(/[^a-zA-Z0-9 äöüÄÖÜß._-]/g,"");
      state.currentMenu = "home";
      save(); render();
    };

    // ---- BILDUPLOAD ----
    function onFileChange(e, cb) {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = evt => cb(evt.target.result);
      reader.readAsDataURL(file);
    }
    function pickProfilePic(cb) {
      const input = document.getElementById("fileInput");
      input.value = "";
      input.onchange = (e) => onFileChange(e, cb);
      input.click();
    }

    // ---- AUTOS ----
    function startLoops() {
      setInterval(()=>{
        // Klicker
        if(state.upgrades.clicker>0) {
          state.clips += getClickValue() * Math.floor(0.7*state.upgrades.clicker);
        }
        // Streamer
        if(state.twitchUnlocked && state.upgrades.streamer>0) {
          state.twitchAbos += getStreamerValue() * Math.floor(0.7*state.upgrades.streamer);
        }
        // Cutter
        if(state.upgrades.cutter>0 && state.clips>=3) {
          let cutBatch = 3 + Math.floor(state.upgrades.cutter/2);
          if(!state.cutMenu.open && state.clips>=cutBatch) {
            state.clips -= cutBatch;
            let abos = getAboGain(state.videos.length);
            state.videos.push({name:"Auto-Video",clips:cutBatch,abos:abos});
            state.abos += abos;
            addPlayButton();
            unlockTwitch();
          }
        }
        // Abo-Verlust
        if(Math.random()<0.1 && state.abos>30) {
          let loss = Math.floor(Math.random()*2+1);
          state.abos -= loss;
          state.lostAbos += loss;
        }
        save(); render();
      }, 2500);
    }

    // ---- INIT ----
    window.onload = ()=>{
      load();
      if(!state.profile.ytName) state.currentMenu = "start";
      render();
      startLoops();
    };
  </script>
</body>
</html>
